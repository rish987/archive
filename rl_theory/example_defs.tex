\def\agent#1{\draw (center) node [rectangle, draw=black, fill=blue, inner sep=0.14cm, #1] {};}

\def\tilecoords#1#2{\draw ($(#1 * \tilesep,#2 * \tilesep)$) node (center) {};}
\def\tile#1{\draw (center) node (#1) [rectangle, draw=black, inner sep=1cm] {};}
\def\tileidx#1{\draw ($(center) - (0.5, 0.5)$) node [rectangle, draw=black, minimum size=0.4cm] {{#1}};}

\def\tileandidx#1{\tile{#1}\tileidx{#1}}

\def\tilecenter#1#2{\draw (#1, #2) node (center) {};}
\def\tiledir#1#2{\draw [->, #1] (center) -- +#2;}
\def\tileup#1{\tiledir{#1}{(0, -0.5)}}
\def\tiledown#1{\tiledir{#1}{(0, 0.5)}}
\def\tileright#1{\tiledir{#1}{(0.5, 0)}}
\def\tileleft#1{\tiledir{#1}{(-0.5, 0)}}

\def\tiletransition#1#2#3#4{\draw [->, opacity=#4] (#1) -- node [#3] {#4} (#2);}

\def\tilesep{2}

\def\actions#1#2{
  \ifbool {#1 > 0} { \tileup{} }{}
  \ifbool {#1 < 2} { \tiledown{} }{}
  \ifbool {#2 < 2} { \tileright{} }{}
  \ifbool {#2 > 0} { \tileleft{} }{}
}

\def\tileloop#1{
  \foreach \row in {0,1,...,2}
  {\sc{row}{\row}
    \foreach \col in {0,1,...,2}
    {\sc{col}{\col}
      \tilecoords{\col}{\row}
      \setidx
      #1
    }
  }
}

\def\board#1{
  \def\setidx{\sc{idx}{(\value{col} + \value{row} * 3) + 1}}
  \tileloop {\tileandidx{\theidx}}
  #1
}

\def\tilerwdraw#1#2{
    \draw #2 node [rectangle, fill=lightlightgray, minimum size=0.4cm] {#1};
}
\def\tilerwd#1{
  \tilerwdraw{#1}{($(center) - (-0.5, 0.5)$)}
}
\def\tileact#1{
  \ifbool{#1 == 0}{ \tileup{strategyact} }{}
  \ifbool{#1 == 1}{ \tileright{strategyact} }{}
  \ifbool{#1 == 2}{ \tiledown{strategyact} }{}
  \ifbool{#1 == 3}{ \tileleft{strategyact} }{}
  \agent{strategyagt}
}
\def\fullboard#1{
  \board
  {
    \runcmd{python rewards.py}
    \input{temp_rewards.tex}
    \tileloop 
    {
      \tilecoords{\col}{\row}
      \tilerwd{\getl{reward\theidx}};
    }
    #1
  }
}
\def\fullboardact#1{
  \fullboard{
    \runcmd{python actions.py actions_#1.dat}
    \input{temp_actions.tex}
    \tileloop 
    {
      \tilecoords{\col}{\row}
      \tileact{\getl{action\theidx}};
    }
  }
}

\pgfkeys{/tikz/board/.style={y=-1cm, scale=1, every node/.style={transform shape}}}
\pgfkeys{/tikz/strategy/.style={opacity=0.35}}
\pgfkeys{/tikz/strategyagt/.style={strategy}}
\pgfkeys{/tikz/strategyact/.style={strategy, draw opacity=0.7, draw=blue}}

\nc{row}
\nc{col}
\nc{idx}

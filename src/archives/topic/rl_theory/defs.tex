\def\brd{\hlg{environment}}
\def\agt{\hlg{agent}}
\def\til{\hlg{state}}
\def\act{\hlg{action}}
\def\stp{\hlg{step}}
\def\lmt{\hlg{step limit}}
\def\trd{\hlg{transition distribution}}
\def\ind{\hlg{initial distribution}}
\def\rwd{\hlg{return}}
\def\str{\hlg{strategy}}
\def\strs{\hlg{strateg}ies}
\def\stpstr{\hlg{step-strategy}}
\def\stpstrs{\hlg{step-strateg}ies}
\def\run{\hlg{run}}
\def\trwd{\hlg{total return}}
\def\atrwd{\hlg{average total return}}

% ---

\def\S{\enm{\mathbf S}}
\def\SV{\enm{\rm S}}
\def\SS{\enm{\rm s}}
\def\AV{\enm{\rm A}}
\def\A{\enm{\mathbf A}}
\def\AA{\enm{\rm a}}
\def\RW{{R}}

\def\T{\enm{T}}
\def\TT{\enm{t}}
\def\TTM{\enm{\TT - 1}}
\def\ST{\enm{\mathbf \Pi}}
\def\STT{\enm{\pi}}

\def\PSTT{\enm{\P_{\STT}}}
\def\ESTT{\enm{{\mathbb E}_{\STT}}}

\def\PP{\enm{\rm P}}
\def\PIND{\enm{\PP_{\rm I}}}
\def\PACT#1#2#3#4{\enm{\PP_{{\rm A}}\left(#1, #2 : #3 \mid #4\right)}}
\def\PTRD#1#2#3{\enm{\PP_{\rm T}\left(#1 \mid #2, #3\right)}}

\def\astr{\enm{\STT \in \ST}}
% ---

  \def\agent#1{\draw (center) node [rectangle, draw=black, fill=blue, inner sep=0.14cm, #1] {};}

  \def\tilecoords#1#2{\draw ($(#1 * \tilesep,#2 * \tilesep)$) node (center) {};}
  \def\tile#1{\draw (center) node (#1) [rectangle, draw=black, inner sep=1cm] {};}
  \def\tileidx#1{\draw ($(center) - (0.5, 0.5)$) node [rectangle, draw=black, minimum size=0.4cm] {{#1}};}

  \def\tileandidx#1{\tile{#1}\tileidx{#1}}

  \def\tilecenter#1#2{\draw (#1, #2) node (center) {};}
  \def\tiledir#1#2{\draw [->, #1] (center) -- +#2;}
  \def\tileup#1{\tiledir{#1}{(0, -0.5)}}
  \def\tiledown#1{\tiledir{#1}{(0, 0.5)}}
  \def\tileright#1{\tiledir{#1}{(0.5, 0)}}
  \def\tileleft#1{\tiledir{#1}{(-0.5, 0)}}

  \def\tiletransition#1#2#3#4{\draw [->, opacity=#4] (#1) -- node [#3] {#4} (#2);}

  \def\tilesep{2}

  \def\actions{
    \tileup{}
    \tiledown{}
    \tileright{}
    \tileleft{}
  }

  \def\tileloop#1{
    \foreach \row in {0,1,...,2}
    {\sc{a}{\row}
      \foreach \col in {0,1,...,2}
      {\sc{b}{\col}
        \tilecoords{\col}{\row}
        \setidx
        #1
      }
    }
  }

  \def\board#1{
    \def\setidx{\sc{c}{(\value{b} + \value{a} * 3) + 1}}
    \tileloop {\tileandidx{\thec}}
    #1
  }
  
  \def\tilerwdraw#1#2{
      \draw #2 node [rectangle, fill=__gray, minimum size=0.4cm] {#1};
  }
  \def\tilerwd#1{
    \tilerwdraw{#1}{($(center) - (-0.5, 0.5)$)}
  }
  \def\tileact#1{
    \ifbool{#1 == 0}{ \tileup{strategyact} }{}
    \ifbool{#1 == 1}{ \tileright{strategyact} }{}
    \ifbool{#1 == 2}{ \tiledown{strategyact} }{}
    \ifbool{#1 == 3}{ \tileleft{strategyact} }{}
    \agent{strategyagt}
  }
  \def\fullboard#1{
    \board
    {
      \input{\curr/_input/rewards.tex}
      \tileloop 
      {
        \tilecoords{\col}{\row}
        \tilerwd{\getl{reward\thec}};
      }
      #1
    }
  }
  \def\fullboardact#1{
    \fullboard{
      \input{\curr/_input/actions_#1.tex}
      \tileloop 
      {
        \tilecoords{\col}{\row}
        \tileact{\getl{action\thec}};
      }
    }
  }

\pgfkeys{/tikz/board/.style={y=-1cm, scale=1, every node/.style={transform shape}}}
\pgfkeys{/tikz/strategy/.style={opacity=0.35}}
\pgfkeys{/tikz/strategyagt/.style={strategy}}
\pgfkeys{/tikz/strategyact/.style={strategy, draw opacity=0.7, draw=blue}}

% ---
\def\whbdt{We have by definition that}
\def\whenfollow{when the \agt\ follows a \str\ $\astr$}

  \def\condprobpath{archives/topic/rl_theory/proof/actcind/proof/ponecind/definition/condprob}
  \def\margprobpath{archives/topic/rl_theory/proof/actcind/proof/ponecind/definition/margprob}
